//dynmic code in proxy:

let currentTarget = 'http://localhost:8000';

app.use('/proxy', createProxyMiddleware({
  router: function(req) {
    return currentTarget;
  },
  changeOrigin: true,
  pathRewrite: { '^/proxy': '' },
  onProxyRes: (proxyRes) => {
    proxyRes.headers['Access-Control-Allow-Origin'] = '*';
  }
}));

app.post('/config', express.json(), (req, res) => {
  currentTarget = req.body.target;
  res.send({ status: 'updated', target: currentTarget });
});

//and the relevant code in the simpleplayer etc

const updateProxyTarget = async (ip) => {
  await fetch('http://localhost:3001/config', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ target: `http://${ip}:port` })
  });
};
